<!doctype html>     <!-- HTML5 Î¨∏ÏÑú -->
<html xmlns:th="http://www.thymeleaf.org"> <!-- Thymeleaf Î¨∏Î≤ï(th: Ï†ëÎëêÏñ¥)ÏùÑ Ïì∏ Ïàò ÏûàÍ≤å ÏÑ§Ï†ï -->
<head>
    <meta charset="UTF-8">  <!-- Í∏ÄÏûê Ïù∏ÏΩîÎî© -->
    <meta name="format-detection" content="telephone=no">
<!--    <meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <!-- Î∞òÏùëÌòï ÌôîÎ©¥ ÏÑ§Ï†ï (Ìè∞/PC ÌôîÎ©¥ ÏûêÎèôÎßûÏ∂§) -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">   <!-- ÏµúÏã† Î≤ÑÏ†ÑÏùò Internet Explorer(IE) ÏóîÏßÑÏúºÎ°ú Î†åÎçîÎßÅ(Í∑∏Î¶¨Í∏∞) -->
    <meta name="robots" content="noindex">  <!-- Í≤ÄÏÉâ ÏóîÏßÑÏù¥ Ïù¥ ÌéòÏù¥ÏßÄÎ•º ÌÅ¨Î°§ÎßÅÌï¥ÎèÑ Í≤ÄÏÉâ Í≤∞Í≥ºÏóê Ïïà Îú®Í≤å ÌïòÎäî ÏÑ§Ï†ï -->
    <meta name="googlebot" content="noindex">      <!-- Íµ¨Í∏Ä Î°úÎ¥áÏù¥ ÌéòÏù¥ÏßÄ Ïù∏Îç±Ïä§ Í∏àÏßÄ -->
    <!-- Bootstrap CSS CDN -->
    <th:block th:replace="~{fragments/head :: commonHead}"></th:block> <!-- fragments/head.html ÌååÏùºÏùò commonHead Î∂ÄÎ∂ÑÏùÑ Í∞ÄÏ†∏ÏôÄÏÑú ÏÇ¨Ïö© -->

    <link href="/admin/css/toast.css" rel="stylesheet"/>
    <script src="/admin/js/lib/jquery-3.2.1.min.js"></script>
    <script src="/admin/js/toast.js"></script>
</head>
<body>
<div id="wrap" class="frame">
    <div th:replace="~{fragments/header :: header}"></div>

    <div id="container" class="container">
        <div class="title-bar">
            <h2 class="page-title ellipsis">
                Î©îÎâ¥ Î™©Î°ù  (<span th:text="${menus.totalElements}">0</span>)
            </h2>
        </div>

        <main id="content">
            <div class="box-wrap">
                <div id="search" class="search">
                    <form name="frm" id="frm" method="get">
                        <fieldset>
                            <legend class="blind">Í≤ÄÏÉâ</legend>
                            <div class="pack-both">
                                <div class="pack-left">
                                    <input type="hidden" name="type" th:value="${menuSearchDTO.type}" />
                                    <input type="hidden" name="menuShow" th:value="${menuSearchDTO.menuShow}" />

                                    <input title="Í≤ÄÏÉâÏñ¥" type="search" name="s" th:value="${menuSearchDTO.s}" class="input-text medium form-control" placeholder="ÏÉÅÌíàÎ™ÖÏúºÎ°ú Í≤ÄÏÉâ" />
                                    <input type="submit" value="Í≤ÄÏÉâ" class="btn medium color1"/>
                                </div>

                                <div class="pack-left">
                                    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ -->
                                    <div class="btn medium bdr-color1 btn-group btn-group-toggle" data-bs-toggle="buttons">

                                        <!-- Ï†ÑÏ≤¥ Î≤ÑÌäº -->
                                        <label class="btn medium"
                                               th:classappend="${menuSearchDTO.menuCategoryId == null or menuSearchDTO.menuCategoryId == 0} ? ' active' : ''">
                                            <input type="radio" name="menuCategoryId" value="0"
                                                   th:checked="${menuSearchDTO.menuCategoryId == null or menuSearchDTO.menuCategoryId == 0}"
                                                   onclick="setFilter(0)">
                                            Ï†ÑÏ≤¥
                                        </label>

                                        <!-- DB Ïπ¥ÌÖåÍ≥†Î¶¨ Î∞òÎ≥µ -->
                                        <label th:each="c : ${menuCategories}" class="btn medium"
                                               th:classappend="${menuSearchDTO.menuCategoryId == c.menuCategoryId} ? ' active'">
                                            <input type="radio" name="menuCategoryId"
                                                   th:value="${c.menuCategoryId}"
                                                   th:checked="${menuSearchDTO.menuCategoryId == c.menuCategoryId}"
                                                   th:attr="onclick=|setFilter(${c.menuCategoryId})|">
                                            <span th:text="${c.menuCategoryName}">Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö</span>
                                        </label>


                                    </div>
                                </div>

                                <!-- ÌåêÎß§ÏÉÅÌÉú ÌïÑÌÑ∞ Î≤ÑÌäº Í∑∏Î£π -->
                                <div class="pack-left">
                                    <div class="btn medium bdr-color1 btn-group btn-group-toggle" data-bs-toggle="buttons">

                                        <!-- ÏÉÅÌÉú Ï†ÑÏ≤¥ -->
                                        <label class="btn medium"
                                               th:classappend="${menuSearchDTO.menuShow == null} ? ' active' : ''">
                                            <input type="radio" name="menuShow" value=""
                                                   th:checked="${menuSearchDTO.menuShow == null}"
                                                   onclick="setShowFilter('')">
                                            Ï†ÑÏ≤¥
                                        </label>

                                        <!-- ÌåêÎß§Ï§ë -->
                                        <label class="btn medium"
                                               th:classappend="${menuSearchDTO.menuShow != null
                       and menuSearchDTO.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).SHOW}
                       ? ' active' : ''">
                                            <input type="radio" name="menuShow"
                                                   th:value="${T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).SHOW}"
                                                   th:checked="${menuSearchDTO.menuShow != null
                       and menuSearchDTO.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).SHOW}"
                                                   onclick="setShowFilter('SHOW')">
                                            ÌåêÎß§Ï§ë
                                        </label>

                                        <!-- Ï§ëÏßÄ -->
                                        <label class="btn medium"
                                               th:classappend="${menuSearchDTO.menuShow != null
                       and menuSearchDTO.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).HIDE}
                       ? ' active' : ''">
                                            <input type="radio" name="menuShow"
                                                   th:value="${T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).HIDE}"
                                                   th:checked="${menuSearchDTO.menuShow != null
                       and menuSearchDTO.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).HIDE}"
                                                   onclick="setShowFilter('HIDE')">
                                            Ï§ëÏßÄ
                                        </label>

                                    </div>
                                </div>


                                <!-- ÌéòÏù¥ÏßÄ ÏÇ¨Ïù¥Ï¶à -->
                                <div class="pack-left page-size">
                                    <select title="Î∑∞ÏÇ¨Ïù¥Ï¶à" th:field="${menuSearchDTO.size}" class="select medium"
                                            onchange="setPageSize(this.value)">
                                        <option value="10">10</option>
                                        <option value="30">30</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    <span class="fs-ss">Í∞úÏî© Î≥¥Í∏∞</span>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>

                <section class="pack-down">
                    <div class="list-header pack-both">
                        <div class="pack-right">
                            <a href="/admin/menu/write" class="btn medium color2">ÏÉÅÌíà Îì±Î°ù</a>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                        <tr>
                            <th scope="col" style="width:40px">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th scope="col">ÌåêÎß§ÏÉÅÌÉú</th>
                            <th scope="col">ÏÉÅÌíàÏΩîÎìú</th>
                            <th scope="col">Î©îÎâ¥Î™Ö</th>
                            <th scope="col">Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                            <th scope="col">Ï£ºÏû¨Î£å</th>
                            <th scope="col">Í∏àÏï°(Ïõê)</th>
                            <th scope="col">ÏπºÎ°úÎ¶¨(kcal)</th>
                            <th scope="col">Í¥ÄÎ¶¨</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="menu, stat : ${menus.content}">
                            <td>
                                <input type="checkbox" class="row-checkbox" th:value="${menu.menuId}">
                            </td>
                            <td>
                                <span class="badge rounded-pill"
                                    th:classappend="${menu.menuShow != null and menu.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).SHOW}
                                                     ? ' bg-success text-white'
                                                     : ' bg-danger text-white'"
                                    th:text="${menu.menuShow != null and menu.menuShow == T(com.boot.ict05_final_admin.domain.menu.entity.MenuShow).SHOW}
                                              ? 'ÌåêÎß§Ï§ë' : 'Ï§ëÏßÄ'">
                                    ÌåêÎß§ÏÉÅÌÉú
                                </span>
                            </td>


                            <td th:text="${menu.menuCode}">ÏÉÅÌíàÏΩîÎìú</td>
                            <td>
                                <span class="fc-333 fw-600" th:text="${menu.menuName}">Î©îÎâ¥Î™Ö</span>
                            </td>
                            <td th:text="${menu.menuCategoryName}">Ïπ¥ÌÖåÍ≥†Î¶¨</td>
                            <td th:text="${#strings.listJoin(menu.materialNames, ', ')}">Ï£ºÏû¨Î£å</td>
                            <td th:text="${#numbers.formatInteger(menu.menuPrice, 0, 'COMMA')}">Í∏àÏï°</td>
                            <td th:text="${menu.menuKcal != null ? menu.menuKcal : 0}">ÏπºÎ°úÎ¶¨</td>
                            <td>
                                <a th:href="@{/menu/detail/{menuId}(menuId=${menu.menuId})}" class="btn small bdr-gray">
                                    <span class="material-symbols-outlined md-18">visibility</span>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div style="text-align: center;">
                        <div th:replace="~{fragments/pagination :: pagination (pageVars=${menus})}"></div>
                    </div>
                </section>
            </div>
        </main>
        <div th:replace="~{fragments/footer :: footer}"></div>
    </div><!-- // #container  -->
</div><!--#wrap.frame-->

<script>
    const selectAll = document.getElementById('selectAll');     // Ï†ÑÏ≤¥ÏÑ†ÌÉù Ï≤¥ÌÅ¨Î∞ïÏä§

    const getRowCheckboxes = () => Array.from(document.querySelectorAll('.row-checkbox'));

    selectAll.addEventListener('change', () => {   // Ï†ÑÏ≤¥ÏÑ†ÌÉù ÎàÑÎ•¥Î©¥ ‚Üí Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ ON/OFF
        const all = getRowCheckboxes();
        all.forEach(cb => cb.checked = selectAll.checked);
        selectAll.indeterminate = false;
    });

    document.addEventListener('change', (e) => {    // Í∞úÎ≥Ñ Ï≤¥ÌÅ¨Î∞ïÏä§ ÌïòÎÇòÏî© ÌÅ¥Î¶≠
        if (!e.target.classList.contains('row-checkbox')) return;
        updateSelectAllState();
    });

    function updateSelectAllState() {       // Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î∞ïÏä§ Ï§ë Ï≤¥ÌÅ¨Îêú Í∞úÏàòÎ•º ÏÑ∏Ïñ¥ÏÑú Í∞ÅÍ∞Å Ï≤òÎ¶¨
        const all = getRowCheckboxes();
        if (all.length === 0) {
            selectAll.checked = false;
            selectAll.indeterminate = false;
            return;
        }
        const checkedCount = all.filter(cb => cb.checked).length;
        if (checkedCount === 0) {
            selectAll.checked = false;
            selectAll.indeterminate = false;
        } else if (checkedCount === all.length) {
            selectAll.checked = true;
            selectAll.indeterminate = false;
        } else {
            selectAll.checked = false;
            selectAll.indeterminate = true;
        }
    }

    document.addEventListener('DOMContentLoaded', updateSelectAllState);    // ÌéòÏù¥ÏßÄÍ∞Ä Î°úÎìúÎê† Îïå(Ï≤òÏùå ÌôîÎ©¥ Ïó¥Î¶¥ Îïå) Ï†ÑÏ≤¥ÏÑ†ÌÉù ÏÉÅÌÉú Í∞±Ïã†
</script>

<script>
    function setFilter(catId) {
        const frm = document.getElementById('frm');
        const catInput = frm.querySelector('[name="menuCategoryId"]');
        if (catInput) catInput.value = catId;

        const pageInput = document.createElement('input');
        pageInput.type = 'hidden';
        pageInput.name = 'page';
        pageInput.value = '1';
        frm.appendChild(pageInput);

        frm.submit();
    }

    function setShowFilter(showVal) {
        const frm = document.getElementById('frm');
        let showInput = frm.querySelector('[name="menuShow"]');
        if (!showInput) {
            showInput = document.createElement('input');
            showInput.type = 'hidden';
            showInput.name = 'menuShow';
            frm.appendChild(showInput);
        }
        showInput.value = showVal;

        const pageInput = document.createElement('input');
        pageInput.type = 'hidden';
        pageInput.name = 'page';
        pageInput.value = '1';
        frm.appendChild(pageInput);

        frm.submit();
    }

    // üîΩ ÏÉàÎ°ú Ï∂îÍ∞Ä
    function setPageSize(size) {
        const frm = document.getElementById('frm');
        // page=1 Î°ú Ï¥àÍ∏∞Ìôî
        const pageInput = document.createElement('input');
        pageInput.type = 'hidden';
        pageInput.name = 'page';
        pageInput.value = '1';
        frm.appendChild(pageInput);

        frm.submit(); // size Í∞íÏùÄ select(name="size")Í∞Ä ÏûêÎèôÏúºÎ°ú Í∞ôÏù¥ Ï†ÑÏÜ°
    }

    document.addEventListener('change', e => {
        if (e.target.name === 'menuCategoryId') setFilter(e.target.value);
        if (e.target.name === 'menuShow')       setShowFilter(e.target.value);
    });
</script>

</body>
</html>